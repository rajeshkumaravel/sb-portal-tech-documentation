<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Sunbird Portal Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Sunbird Portal Documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content class">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Classes</li>
  <li >SbFormLocationSelectionDelegate</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts</code>
        </p>






            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#changesMap" >changesMap</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Static</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST" >DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST</a>
                            </li>
                            <li>
                                    <span class="modifier">Optional</span>
                                <a href="#formGroup" >formGroup</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formLocationOptionsFactory" >formLocationOptionsFactory</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formLocationSuggestions" >formLocationSuggestions</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#formSuggestionsStrategy" >formSuggestionsStrategy</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#guestUserDetails" >guestUserDetails</a>
                            </li>
                            <li>
                                <a href="#isLocationFormLoading" >isLocationFormLoading</a>
                            </li>
                            <li>
                                <a href="#locationFormConfig" >locationFormConfig</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#prevFormValue" >prevFormValue</a>
                            </li>
                            <li>
                                <a href="#shouldDeviceProfileLocationUpdate" >shouldDeviceProfileLocationUpdate</a>
                            </li>
                            <li>
                                <a href="#shouldUserProfileLocationUpdate" >shouldUserProfileLocationUpdate</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Optional</span>
                                <a href="#stateChangeSubscription" >stateChangeSubscription</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Static</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#SUPPORTED_PERSONA_LIST_FORM_REQUEST" >SUPPORTED_PERSONA_LIST_FORM_REQUEST</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#clearUserLocationSelections" >clearUserLocationSelections</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#destroy" >destroy</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getFormSuggestionsStrategy" >getFormSuggestionsStrategy</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#init" >init</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#loadForm" >loadForm</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#onDataLoadStatusChange" >onDataLoadStatusChange</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#onFormInitialize" >onFormInitialize</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#onFormValueChange" >onFormValueChange</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#updateUserLocation" >updateUserLocation</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(userService: <a href="../injectables/UserService.html" target="_self">UserService</a>, locationService: <a href="../injectables/LocationService.html" target="_self">LocationService</a>, formService: <a href="../injectables/FormService.html" target="_self">FormService</a>, deviceRegisterService: <a href="../injectables/DeviceRegisterService.html" target="_self">DeviceRegisterService</a>, orgDetailsService: <a href="../injectables/OrgDetailsService.html" target="_self">OrgDetailsService</a>, deviceProfile?: <a href="../interfaces/IDeviceProfile.html" target="_self">IDeviceProfile</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:38</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>locationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/LocationService.html" target="_self" >LocationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>formService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/FormService.html" target="_self" >FormService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>deviceRegisterService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/DeviceRegisterService.html" target="_self" >DeviceRegisterService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>orgDetailsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/OrgDetailsService.html" target="_self" >OrgDetailsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>deviceProfile</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/IDeviceProfile.html" target="_self" >IDeviceProfile</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            Yes
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="changesMap"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>changesMap</b></span>
                        <a href="#changesMap"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../miscellaneous/variables.html#type" target="_self" >literal type</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>{}</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="37" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:37</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Static</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST</b></span>
                        <a href="#DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank" >object</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>{ formType: &#x27;profileConfig_v2&#x27;, contentType: &#x27;default&#x27;, formAction: &#x27;get&#x27; }</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="19" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:19</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formGroup"></a>
                    <span class="name">
                            <span class="modifier">Optional</span>
                        <span ><b>formGroup</b></span>
                        <a href="#formGroup"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://angular.io/api/forms/FormGroup" target="_blank" >FormGroup</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:28</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formLocationOptionsFactory"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formLocationOptionsFactory</b></span>
                        <a href="#formLocationOptionsFactory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/SbFormLocationOptionsFactory.html" target="_self" >SbFormLocationOptionsFactory</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:33</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formLocationSuggestions"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formLocationSuggestions</b></span>
                        <a href="#formLocationSuggestions"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../miscellaneous/variables.html#L" target="_self" >Partial&lt;SbLocation&gt;[]</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>[]</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="32" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:32</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="formSuggestionsStrategy"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>formSuggestionsStrategy</b></span>
                        <a href="#formSuggestionsStrategy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../miscellaneous/variables.html#L" target="_self" >&quot;userLocation&quot; | &quot;userDeclared&quot; | &quot;ipLocation&quot;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:31</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="guestUserDetails"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>guestUserDetails</b></span>
                        <a href="#guestUserDetails"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="38" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:38</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isLocationFormLoading"></a>
                    <span class="name">
                        <span ><b>isLocationFormLoading</b></span>
                        <a href="#isLocationFormLoading"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>false</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="29" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:29</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="locationFormConfig"></a>
                    <span class="name">
                        <span ><b>locationFormConfig</b></span>
                        <a href="#locationFormConfig"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>FieldConfig&lt;any&gt;[]</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:27</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="prevFormValue"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>prevFormValue</b></span>
                        <a href="#prevFormValue"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../miscellaneous/variables.html#type" target="_self" >literal type</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>{}</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="34" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:34</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="shouldDeviceProfileLocationUpdate"></a>
                    <span class="name">
                        <span ><b>shouldDeviceProfileLocationUpdate</b></span>
                        <a href="#shouldDeviceProfileLocationUpdate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>false</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="24" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:24</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="shouldUserProfileLocationUpdate"></a>
                    <span class="name">
                        <span ><b>shouldUserProfileLocationUpdate</b></span>
                        <a href="#shouldUserProfileLocationUpdate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>false</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="25" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:25</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="stateChangeSubscription"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Optional</span>
                        <span ><b>stateChangeSubscription</b></span>
                        <a href="#stateChangeSubscription"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Subscription</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="35" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:35</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="SUPPORTED_PERSONA_LIST_FORM_REQUEST"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Static</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>SUPPORTED_PERSONA_LIST_FORM_REQUEST</b></span>
                        <a href="#SUPPORTED_PERSONA_LIST_FORM_REQUEST"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/object" target="_blank" >object</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>{ formType: &#x27;config&#x27;, formAction: &#x27;get&#x27;, contentType: &#x27;userType&#x27;, component: &#x27;portal&#x27; }</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="clearUserLocationSelections"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>clearUserLocationSelections</b></span>
                        <a href="#clearUserLocationSelections"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>clearUserLocationSelections()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="271"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:271</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="destroy"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>destroy</b></span>
                        <a href="#destroy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>destroy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="89"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:89</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFormSuggestionsStrategy"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>getFormSuggestionsStrategy</b></span>
                        <a href="#getFormSuggestionsStrategy"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFormSuggestionsStrategy()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="422"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:422</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Partial[]</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="init"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>init</b></span>
                        <a href="#init"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>init(deviceProfile?: <a href="../interfaces/IDeviceProfile.html" target="_self">IDeviceProfile</a>, showModal, isStepper)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="55"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:55</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceProfile</td>
                                    <td>
                                                <code><a href="../interfaces/IDeviceProfile.html" target="_self" >IDeviceProfile</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>showModal</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>true</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>isStepper</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="loadForm"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>loadForm</b></span>
                        <a href="#loadForm"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>loadForm(formInputParams, initial, showModal, isStepper)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="279"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:279</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>formInputParams</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>initial</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>showModal</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>true</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>isStepper</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onDataLoadStatusChange"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>onDataLoadStatusChange</b></span>
                        <a href="#onDataLoadStatusChange"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>onDataLoadStatusChange($event, showModal, isStepper)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="108"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:108</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>$event</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>showModal</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>true</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>isStepper</td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onFormInitialize"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>onFormInitialize</b></span>
                        <a href="#onFormInitialize"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>onFormInitialize(formGroup: <a href="https://angular.io/api/forms/FormGroup" target="_blank">FormGroup</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="96"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:96</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>formGroup</td>
                                    <td>
                                                <code><a href="https://angular.io/api/forms/FormGroup" target="_blank" >FormGroup</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="onFormValueChange"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>onFormValueChange</b></span>
                        <a href="#onFormValueChange"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>onFormValueChange(value: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="101"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:101</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>value</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserLocation"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>updateUserLocation</b></span>
                        <a href="#updateUserLocation"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateUserLocation()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="159"
                            class="link-to-prism">src/app/plugins/location/components/delegate/sb-form-location-selection.delegate.ts:159</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/variables.html#type" target="_self" >Promise&lt;literal type&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>





    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {Location as SbLocation} from &#x27;@project-sunbird/client-services/models/location&#x27;;
import {FieldConfig, FieldConfigOption} from &#x27;@project-sunbird/common-form-elements&#x27;;
import {FormGroup} from &#x27;@angular/forms&#x27;;
import {delay, distinctUntilChanged, map, mergeMap, take} from &#x27;rxjs/operators&#x27;;
import {SbFormLocationOptionsFactory} from &#x27;./sb-form-location-options.factory&#x27;;
import {concat, defer, of, Subscription} from &#x27;rxjs&#x27;;
import {IDeviceProfile} from &#x27;@sunbird/shared-feature&#x27;;
import * as _ from &#x27;lodash-es&#x27;;

import {LocationService} from &#x27;../../services/location/location.service&#x27;;
import {UserService} from &#x27;../../../../modules/core/services/user/user.service&#x27;;
import {DeviceRegisterService} from &#x27;../../../../modules/core/services/device-register/device-register.service&#x27;;
import {FormService} from &#x27;../../../../modules/core/services/form/form.service&#x27;;
import { OrgDetailsService } from &#x27;@sunbird/core&#x27;;

type UseCase &#x3D; &#x27;SIGNEDIN_GUEST&#x27; | &#x27;SIGNEDIN&#x27; | &#x27;GUEST&#x27;;

export class SbFormLocationSelectionDelegate {
  private static readonly DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST &#x3D;
    { formType: &#x27;profileConfig_v2&#x27;, contentType: &#x27;default&#x27;, formAction: &#x27;get&#x27; };
  private static readonly SUPPORTED_PERSONA_LIST_FORM_REQUEST &#x3D;
    { formType: &#x27;config&#x27;, formAction: &#x27;get&#x27;, contentType: &#x27;userType&#x27;, component: &#x27;portal&#x27; };

  shouldDeviceProfileLocationUpdate &#x3D; false;
  shouldUserProfileLocationUpdate &#x3D; false;

  locationFormConfig: FieldConfig&lt;any&gt;[];
  formGroup?: FormGroup;
  isLocationFormLoading &#x3D; false;

  private formSuggestionsStrategy: &#x27;userLocation&#x27; | &#x27;userDeclared&#x27; | &#x27;ipLocation&#x27;;
  private formLocationSuggestions: Partial&lt;SbLocation&gt;[] &#x3D; [];
  private formLocationOptionsFactory: SbFormLocationOptionsFactory;
  private prevFormValue: {} &#x3D; {};
  private stateChangeSubscription?: Subscription;

  private changesMap: {} &#x3D; {};
  private guestUserDetails;

  constructor(
    private userService: UserService,
    private locationService: LocationService,
    private formService: FormService,
    private deviceRegisterService: DeviceRegisterService,
    private orgDetailsService: OrgDetailsService,
    private deviceProfile?: IDeviceProfile
  ) {
    this.formLocationOptionsFactory &#x3D; new SbFormLocationOptionsFactory(
      locationService,
      userService,
      orgDetailsService
    );
  }

  async init(deviceProfile?: IDeviceProfile, showModal &#x3D; true, isStepper&#x3D; false) {
    if (deviceProfile) {
      this.deviceProfile &#x3D; deviceProfile;
    }

    try {
      if (!this.deviceProfile) {
        this.deviceProfile &#x3D; await this.deviceRegisterService.fetchDeviceProfile().pipe(
          map((response) &#x3D;&gt; _.get(response, &#x27;result&#x27;))
        ).toPromise();
      }

      this.formLocationSuggestions &#x3D; this.getFormSuggestionsStrategy();

      // try loading state specific form
      const formInputParams &#x3D; _.cloneDeep(SbFormLocationSelectionDelegate.DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST);
      if (this.userService.loggedIn) {
        // override contentType to userLocation&#x27;s state ID if available
        formInputParams[&#x27;contentType&#x27;] &#x3D; (() &#x3D;&gt; {
          const loc: SbLocation &#x3D; (this.userService.userProfile[&#x27;userLocations&#x27;] || [])
            .find((l: SbLocation) &#x3D;&gt; l.type &#x3D;&#x3D;&#x3D; &#x27;state&#x27;);
          return (loc &amp;&amp; loc.code) ?
            loc.code :
            SbFormLocationSelectionDelegate.DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST.contentType;
        })();
      } 
      await this.loadForm(formInputParams, true, showModal, isStepper);
    } catch (e) {
      // load default form
      console.error(e);
      await this.loadForm(SbFormLocationSelectionDelegate.DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST, true, showModal, isStepper);
    }
  }

  async destroy() {
    if (this.stateChangeSubscription) {
      this.stateChangeSubscription.unsubscribe();
      this.stateChangeSubscription &#x3D; undefined;
    }
  }

  async onFormInitialize(formGroup: FormGroup) {
    this.isLocationFormLoading &#x3D; false;
    this.formGroup &#x3D; formGroup;
  }

  async onFormValueChange(value: any) {
    if (value[&#x27;children&#x27;] &amp;&amp; value[&#x27;children&#x27;][&#x27;persona&#x27;]) {
      this.shouldDeviceProfileLocationUpdate &#x3D; true;
      this.shouldUserProfileLocationUpdate &#x3D; true;
    }
  }

  async onDataLoadStatusChange($event, showModal &#x3D; true, isStepper &#x3D; false) {
    if (&#x27;LOADED&#x27; &#x3D;&#x3D;&#x3D; $event) {
      this.isLocationFormLoading &#x3D; false;

      const subPersonaFormControl &#x3D; this.formGroup.get(&#x27;children.persona.subPersona&#x27;);
      if (subPersonaFormControl &amp;&amp; !subPersonaFormControl.value) {
        subPersonaFormControl.patchValue((_.get(this.userService.userProfile.profileUserType, &#x27;subType&#x27;) || &#x27;&#x27;) || null);
      }

      if (!this.stateChangeSubscription) {
        this.stateChangeSubscription &#x3D; concat(
          of(this.formGroup.get(&#x27;persona&#x27;).value),
          this.formGroup.get(&#x27;persona&#x27;).valueChanges
        ).pipe(
          distinctUntilChanged(),
          delay(100),
          mergeMap(() &#x3D;&gt; defer(() &#x3D;&gt; {
            return this.formGroup?.get(&#x27;children.persona.state&#x27;)?.valueChanges.pipe(
              distinctUntilChanged(),
              take(1)
            );
          }))
        ).subscribe((newStateValue) &#x3D;&gt; {
          // on state change
          if (!newStateValue) { return; }

          this.locationFormConfig &#x3D; undefined;
          this.stateChangeSubscription &#x3D; undefined;

          this.isLocationFormLoading &#x3D; true;

          this.prevFormValue &#x3D; _.cloneDeep(this.formGroup.value);

          this.loadForm(
            {
              ...SbFormLocationSelectionDelegate.DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST,
              contentType: (newStateValue as SbLocation).code,
            },
            false, showModal, isStepper
          ).catch((e) &#x3D;&gt; {
            console.error(e);
            this.loadForm(
              SbFormLocationSelectionDelegate.DEFAULT_PERSONA_LOCATION_CONFIG_FORM_REQUEST,
              false, showModal, isStepper
            );
          });
        });
      }
    }
  }

  async updateUserLocation(): Promise&lt;{ changes: string, deviceProfile?: &#x27;success&#x27; | &#x27;fail&#x27;, userProfile?: &#x27;success&#x27; | &#x27;fail&#x27; }&gt; {
    const changes: string &#x3D; Object.keys(this.changesMap).reduce&lt;string[]&gt;((acc, code) &#x3D;&gt; {
      const isChanged &#x3D; !_.isEqualWith(_.get(this.formGroup.value, code), this.changesMap[code], (a, b) &#x3D;&gt; {
        if (a &amp;&amp; b) {
          return a &#x3D;&#x3D;&#x3D; b || a.code &#x3D;&#x3D;&#x3D; b.code;
        } else if (!a &amp;&amp; !b) {
          return true;
        }
        return a &#x3D;&#x3D;&#x3D; b;
      });

      if (isChanged) {
        acc.push(code + &#x27;::changed&#x27;);
      }

      return acc;
    }, []).join(&#x27;-&#x27;);

    const locationDetails: SbLocation[] &#x3D; Object.keys(_.get(this.formGroup.value, &#x27;children.persona&#x27;))
      .reduce&lt;SbLocation[]&gt;((acc, key) &#x3D;&gt; {
        const locationDetail: SbLocation | null &#x3D; _.get(this.formGroup.value, &#x27;children.persona&#x27;)[key];
        if (_.get(locationDetail, &#x27;code&#x27;)) {
          acc.push(locationDetail);
        }
        return acc;
      }, []);

    const tasks: Promise&lt;any&gt;[] &#x3D; [];

    if (this.shouldDeviceProfileLocationUpdate) {
      const request &#x3D; locationDetails.reduce&lt;{ [locationType: string]: string }&gt;((acc, l) &#x3D;&gt; {
        acc[l.type] &#x3D; l.name;
        return acc;
      }, {});
      const task &#x3D; this.deviceRegisterService.updateDeviceProfile(request).toPromise()
        .then(() &#x3D;&gt; ({ deviceProfile: &#x27;success&#x27; }))
        .catch(() &#x3D;&gt; ({ deviceProfile: &#x27;fail&#x27; }));
      tasks.push(task);
    }

    if (this.shouldUserProfileLocationUpdate &amp;&amp; this.userService.loggedIn) {
      const formValue &#x3D; this.formGroup.value;
      const profileUserTypes &#x3D; [];
      let userType;
      const userTypeReq &#x3D; {};
      if (_.get(formValue, &#x27;children.persona.subPersona.length&#x27;)) {
        if (typeof _.get(formValue, &#x27;children.persona.subPersona&#x27;) &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) {
          userType &#x3D; {
            type: formValue.persona,
            subType: _.get(formValue, &#x27;children.persona.subPersona&#x27;)
          };
          profileUserTypes.push(userType);
        } else if (Array.isArray(_.get(formValue, &#x27;children.persona.subPersona&#x27;))) {
          formValue.children.persona.subPersona.forEach(element &#x3D;&gt; {
            profileUserTypes.push({type: formValue.persona, subType: element});
          });
          userType &#x3D; profileUserTypes[0];
        }
      } else {
        profileUserTypes.push({ type: formValue.persona });
      }
      const payload: any &#x3D; {
        userId: _.get(this.userService, &#x27;userid&#x27;),
        profileLocation: locationDetails,
        profileUserTypes,
        ...(_.get(formValue, &#x27;name&#x27;) ? { firstName: _.get(formValue, &#x27;name&#x27;) } : {} )
      };

      const task &#x3D; this.locationService.updateProfile(payload).toPromise()
        .then(() &#x3D;&gt; ({ userProfile: &#x27;success&#x27;, type: _.get(formValue, &#x27;persona&#x27;) }))
        .catch(() &#x3D;&gt; ({ userProfile: &#x27;fail&#x27; }));
      tasks.push(task);
    }

    if (!this.userService.loggedIn &amp;&amp; this.guestUserDetails) {
      const formValue &#x3D; this.formGroup.value;
      const user &#x3D; { ...this.guestUserDetails, formatedName: _.get(formValue, &#x27;name&#x27;) };

      if (_.get(formValue, &#x27;persona&#x27;)) {
        localStorage.setItem(&#x27;userType&#x27;, formValue.persona);
        const guestUserType &#x3D; (
          await this.formService.getFormConfig(
            SbFormLocationSelectionDelegate.SUPPORTED_PERSONA_LIST_FORM_REQUEST
          ).toPromise() as {
            code: string;
            name: string;
            visibility: boolean;
          }[]
        ).reduce&lt;FieldConfigOption&lt;string&gt;[]&gt;((data, persona) &#x3D;&gt; {
          if (persona.code &#x3D;&#x3D;&#x3D; formValue.persona) {
            data.push({
              label: persona.name,
              value: persona.code
            });
          }
          return data;
        }, []);
        localStorage.setItem(&#x27;guestUserType&#x27;, guestUserType[0].label);
      }
      this.userService.updateGuestUser(user, formValue).subscribe();
    }

    return await Promise.all(tasks).then((result) &#x3D;&gt; {
      return result.reduce&lt;{
        changes: string, deviceProfile?: &#x27;success&#x27; | &#x27;fail&#x27;, userProfile?: &#x27;success&#x27; | &#x27;fail&#x27;
      }&gt;((acc, v) &#x3D;&gt; {
        acc &#x3D; { ...acc, ...v };
        return acc;
      }, { changes });
    });
  }

  async clearUserLocationSelections() {
    const stateFormControl &#x3D; this.formGroup.get(&#x27;children.persona.state&#x27;);
    /* istanbul ignore else */
    if (stateFormControl) {
      stateFormControl.patchValue(null);
    }
  }

  private async loadForm(formInputParams, initial &#x3D; false, showModal &#x3D; true, isStepper &#x3D; false) {
    let useCases: UseCase[];
    // If user register workflow
    if (!showModal) {
      useCases &#x3D; [&#x27;SIGNEDIN_GUEST&#x27;, &#x27;SIGNEDIN&#x27;];
    } else {
      useCases &#x3D; this.userService.loggedIn ? [&#x27;SIGNEDIN_GUEST&#x27;, &#x27;SIGNEDIN&#x27;] : [&#x27;SIGNEDIN_GUEST&#x27;, &#x27;GUEST&#x27;];
    }
    this.isLocationFormLoading &#x3D; true;
    let tempLocationFormConfig: FieldConfig&lt;any&gt;[];
    if (!showModal) {
      tempLocationFormConfig &#x3D; await this.formService.getFormConfig(formInputParams, localStorage.getItem(&#x27;orgHashTagId&#x27;))
        .toPromise();
    } else {
      tempLocationFormConfig &#x3D; await this.formService.getFormConfig(formInputParams)
        .toPromise();
    }
    if (!this.userService.loggedIn &amp;&amp; !isStepper) {
      this.guestUserDetails &#x3D; await this.userService.getGuestUser().toPromise();
    }

    if (!showModal) {
      tempLocationFormConfig.splice(_.findIndex(tempLocationFormConfig, (e) &#x3D;&gt; {
        return e.code &#x3D;&#x3D;&#x3D; &#x27;name&#x27;;
      }), 1);
    }
    for (const config of tempLocationFormConfig) {
      if (config.code &#x3D;&#x3D;&#x3D; &#x27;name&#x27;) {
        if (this.userService.loggedIn) {
          config.templateOptions.hidden &#x3D; false;
          config.default &#x3D; (_.get(this.userService.userProfile, &#x27;firstName&#x27;) || &#x27;&#x27;) || null;
        } else if (this.guestUserDetails) {
          config.templateOptions.hidden &#x3D; false;
          config.default &#x3D; (_.get(this.guestUserDetails, &#x27;formatedName&#x27;) || &#x27;Guest&#x27;);
        } else if (!this.userService.loggedIn &amp;&amp; !this.guestUserDetails &amp;&amp; isStepper) {
          config.templateOptions.hidden &#x3D; false;
          config.default &#x3D; &#x27;Guest&#x27;;
        }
        else {
          config.validations &#x3D; [];
        }
      }

      if (config.code &#x3D;&#x3D;&#x3D; &#x27;persona&#x27;) {
        if (this.userService.loggedIn) {
          config.templateOptions.hidden &#x3D; false;
          config.default &#x3D; (_.get(this.userService.userProfile.profileUserType, &#x27;type&#x27;) || &#x27;&#x27;).toLowerCase() || &#x27;teacher&#x27;;
        } else {
          config.templateOptions.hidden &#x3D; false;
          config.default &#x3D; (localStorage.getItem(&#x27;userType&#x27;) || &#x27;&#x27;).toLowerCase() || &#x27;teacher&#x27;;
        }
      }

      this.changesMap[config.code] &#x3D; config.default;
      config.default &#x3D; _.get(this.prevFormValue, config.code) || config.default;

      if (config.templateOptions[&#x27;dataSrc&#x27;] &amp;&amp; config.templateOptions[&#x27;dataSrc&#x27;][&#x27;marker&#x27;] &#x3D;&#x3D;&#x3D; &#x27;SUPPORTED_PERSONA_LIST&#x27;) {
        config.templateOptions.options &#x3D; (
          await this.formService.getFormConfig(
            SbFormLocationSelectionDelegate.SUPPORTED_PERSONA_LIST_FORM_REQUEST
          ).toPromise() as {
            code: string;
            name: string;
            visibility: boolean;
          }[]
        ).reduce&lt;FieldConfigOption&lt;string&gt;[]&gt;((acc, persona) &#x3D;&gt; {
          if (persona.visibility) {
            acc.push({
              label: persona.name,
              value: persona.code
            });
          }
          return acc;
        }, []);

        for (const persona in config.children) {
          if (!(persona in config.children)) {
            continue;
          }

          for (const personaLocationConfig of config.children[persona]) {
            if (!personaLocationConfig.templateOptions[&#x27;dataSrc&#x27;]) {
              return personaLocationConfig;
            }

            if (!useCases.includes(_.get(personaLocationConfig, &#x27;templateOptions.dataSrc.params.useCase&#x27;))) {
              personaLocationConfig.templateOptions[&#x27;hidden&#x27;] &#x3D; true;
              personaLocationConfig.validations &#x3D; [];
            }

            if (initial) {
              personaLocationConfig.default &#x3D; this.formLocationSuggestions.find(l &#x3D;&gt; l.type &#x3D;&#x3D;&#x3D; personaLocationConfig.code);
            }

            switch (personaLocationConfig.templateOptions[&#x27;dataSrc&#x27;][&#x27;marker&#x27;]) {
              case &#x27;SUBPERSONA_LIST&#x27;: {
                if (this.userService.loggedIn) {
                  if (personaLocationConfig.templateOptions.multiple) {
                    const defaultSubpersona &#x3D; [];
                    if (this.userService.userProfile.profileUserTypes &amp;&amp; this.userService.userProfile.profileUserTypes.length) {
                      this.userService.userProfile.profileUserTypes.forEach(element &#x3D;&gt; {
                        if (element.subType) {
                          defaultSubpersona.push(element.subType);
                        }
                      });
                    } else {
                      if (_.get(this.userService, &#x27;userProfile.profileUserType.subType&#x27;)) {
                        defaultSubpersona.push(_.get(this.userService, &#x27;userProfile.profileUserType.subType&#x27;));
                      }
                    }
                    personaLocationConfig.default &#x3D; defaultSubpersona;
                  } else {
                    personaLocationConfig.default &#x3D; _.get(this.userService, &#x27;userProfile.profileUserType.subType&#x27;);
                  }
                }
                break;
              }
              case &#x27;STATE_LOCATION_LIST&#x27;: {
                personaLocationConfig.templateOptions.options &#x3D; this.formLocationOptionsFactory.buildStateListClosure(
                  personaLocationConfig, initial
                );
                break;
              }
              case &#x27;LOCATION_LIST&#x27;: {
                personaLocationConfig.templateOptions.options &#x3D; this.formLocationOptionsFactory.buildLocationListClosure(
                  personaLocationConfig, initial
                );
                break;
              }
            }

            this.changesMap[&#x60;children.persona.${personaLocationConfig.code}&#x60;] &#x3D; personaLocationConfig.default;
            personaLocationConfig.default &#x3D;
              _.get(this.prevFormValue, &#x60;children.persona.${personaLocationConfig.code}&#x60;) ||
              personaLocationConfig.default;
          }
        }
      }
    }

    this.locationFormConfig &#x3D; tempLocationFormConfig;
  }

  private getFormSuggestionsStrategy(): Partial&lt;SbLocation&gt;[] {
    let suggestions: Partial&lt;SbLocation&gt;[] &#x3D; [];
    const userProfileData &#x3D; this.userService.userProfile;
    const isDeviceProfileLocationUpdated &#x3D; this.deviceProfile &amp;&amp; this.deviceProfile.userDeclaredLocation;
    const isUserProfileLocationUpdated &#x3D; userProfileData &amp;&amp; userProfileData.userLocations &amp;&amp;
      Array.isArray(userProfileData.userLocations) &amp;&amp; userProfileData.userLocations.length &gt;&#x3D; 1;

    if (this.userService.loggedIn) {
      /* istanbul ignore else */
      if (isUserProfileLocationUpdated) {
        this.formSuggestionsStrategy &#x3D; &#x27;userLocation&#x27;;
        this.shouldUserProfileLocationUpdate &#x3D; false;
        this.shouldDeviceProfileLocationUpdate &#x3D; false;

        suggestions &#x3D; this.userService.userProfile.userLocations;
      }

      /* istanbul ignore else */
      if (
        !isUserProfileLocationUpdated
      ) {
        /* istanbul ignore else */
        if (isDeviceProfileLocationUpdated) {
          // render using userDeclaredLocation
          // update user profile only
          this.formSuggestionsStrategy &#x3D; &#x27;userDeclared&#x27;;
          this.shouldUserProfileLocationUpdate &#x3D; true;
          this.shouldDeviceProfileLocationUpdate &#x3D; false;

          suggestions &#x3D; [
            { type: &#x27;state&#x27;, name: this.deviceProfile.userDeclaredLocation.state },
            { type: &#x27;district&#x27;, name: this.deviceProfile.userDeclaredLocation.district }
          ];
        }
      }

      /* istanbul ignore else */
      if (
        !isDeviceProfileLocationUpdated
      ) {
        if (isUserProfileLocationUpdated) {
          // render using user location
          // update only device profile
          this.formSuggestionsStrategy &#x3D; &#x27;userLocation&#x27;;
          this.shouldUserProfileLocationUpdate &#x3D; false;
          this.shouldDeviceProfileLocationUpdate &#x3D; true;

          suggestions &#x3D; this.userService.userProfile.userLocations;
        } else {
          // render using ip
          // update device location and user location
          this.formSuggestionsStrategy &#x3D; &#x27;ipLocation&#x27;;
          this.shouldUserProfileLocationUpdate &#x3D; true;
          this.shouldDeviceProfileLocationUpdate &#x3D; true;

          suggestions &#x3D; [
            { type: &#x27;state&#x27;, name: this.deviceProfile.ipLocation.state },
            { type: &#x27;district&#x27;, name: this.deviceProfile.ipLocation.district }
          ];
        }
      }
    } else {
      if (!isDeviceProfileLocationUpdated) {
        // render using ip
        // update device profile only
        this.formSuggestionsStrategy &#x3D; &#x27;ipLocation&#x27;;
        this.shouldUserProfileLocationUpdate &#x3D; false;
        this.shouldDeviceProfileLocationUpdate &#x3D; true;

        suggestions &#x3D; [
          { type: &#x27;state&#x27;, name: _.get(this.deviceProfile, &#x27;ipLocation.state&#x27;) },
          { type: &#x27;district&#x27;, name: _.get(this.deviceProfile, &#x27;ipLocation.district&#x27;) }
        ];
      } else {
        // render using userDeclaredLocation
        // update user profile only
        this.formSuggestionsStrategy &#x3D; &#x27;userDeclared&#x27;;
        this.shouldUserProfileLocationUpdate &#x3D; true;
        this.shouldDeviceProfileLocationUpdate &#x3D; false;

        suggestions &#x3D; [
          { type: &#x27;state&#x27;, name: this.deviceProfile.userDeclaredLocation.state },
          { type: &#x27;district&#x27;, name: this.deviceProfile.userDeclaredLocation.district }
        ];
      }
    }

    return suggestions;
  }
}
</code></pre>
    </div>
</div>









                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'class';
            var COMPODOC_CURRENT_PAGE_URL = 'SbFormLocationSelectionDelegate.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
