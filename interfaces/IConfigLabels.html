<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Sunbird Portal Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Sunbird Portal Documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  IConfigLabels</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/modules/certificate/components/certificate-configuration/certificate-configuration.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#label" 
>
                                            label
                                        </a>
                                </li>
                                <li>
                                        <a href="#name" 
>
                                            name
                                        </a>
                                </li>
                                <li>
                                        <a href="#show" 
>
                                            show
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="label"></a>
                                        <span class="name "><b>label</b>
                                            <a href="#label">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>label:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name "><b>name</b>
                                            <a href="#name">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="show"></a>
                                        <span class="name "><b>show</b>
                                            <a href="#show">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>show:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { UploadCertificateService } from &#x27;./../../services/upload-certificate/upload-certificate.service&#x27;;
import { CertConfigModel } from &#x27;./../../models/cert-config-model/cert-config-model&#x27;;
import { Component, OnInit, OnDestroy, ViewChild, HostListener } from &#x27;@angular/core&#x27;;
import { CertificateService, UserService, PlayerService, CertRegService, FormService } from &#x27;@sunbird/core&#x27;;
import * as _ from &#x27;lodash-es&#x27;;
import { FormGroup, FormControl, Validators } from &#x27;@angular/forms&#x27;;
import { ResourceService, NavigationHelperService, ToasterService, LayoutService, COLUMN_TYPE } from &#x27;@sunbird/shared&#x27;;
import { Router, ActivatedRoute } from &#x27;@angular/router&#x27;;
import { combineLatest, of, Subject } from &#x27;rxjs&#x27;;
import { catchError, tap, map } from &#x27;rxjs/operators&#x27;;
import { TelemetryService, IImpressionEventInput } from &#x27;@sunbird/telemetry&#x27;;
import { DomSanitizer } from &#x27;@angular/platform-browser&#x27;;

export interface IConfigLabels {
  label: string;
  name: string;
  show: boolean;
}

@Component({
  selector: &#x27;app-certificate-configuration&#x27;,
  templateUrl: &#x27;./certificate-configuration.component.html&#x27;,
  styleUrls: [&#x27;./certificate-configuration.component.scss&#x27;]
})
export class CertificateConfigurationComponent implements OnInit, OnDestroy {
  @ViewChild(&#x27;selectCertType&#x27;) selectCertType;
  @ViewChild(&#x27;selectRecipient&#x27;) selectRecipient;
  @ViewChild(&#x27;templateChangeModal&#x27;) templateChangeModal;
  @ViewChild(&#x27;selectScoreRange&#x27;) selectScoreRange;

  public unsubscribe$ &#x3D; new Subject&lt;void&gt;();
  showPreviewModal;
  showTemplateDetectModal;
  certTypes: any;
  issueTo: any;
  telemetryImpression: IImpressionEventInput;
  userPreference: FormGroup;
  disableAddCertificate &#x3D; true;
  queryParams: any;
  courseDetails: any;
  showLoader &#x3D; true;
  certTemplateList: Array&lt;{}&gt; &#x3D; [];
  batchDetails: any;
  currentState: any;
  screenStates: any &#x3D; { &#x27;default&#x27;: &#x27;default&#x27;, &#x27;certRules&#x27;: &#x27;certRules&#x27; };
  selectedTemplate: any;
  previewTemplate: any;
  configurationMode: string;
  certConfigModalInstance &#x3D; new CertConfigModel();
  previewUrl: string;
  templateIdentifier: string;
  isTemplateChanged &#x3D; false;
  certEditable &#x3D; true;
  config: { select: IConfigLabels, preview: IConfigLabels, remove: IConfigLabels };
  certificate: any;
  newTemplateIdentifier: any;
  showAlertModal &#x3D; false;
  addScoreRule &#x3D; false;
  arrayValue &#x3D; {};
  scoreRange: any;
  isSingleAssessment &#x3D; false;
  isStateCertificate &#x3D; false;
  instance: string;
  layoutConfiguration: any;
  FIRST_PANEL_LAYOUT;
  SECOND_PANEL_LAYOUT;
  certificateFormConfig: any;

  constructor(
    private certificateService: CertificateService,
    private userService: UserService,
    private playerService: PlayerService,
    private sanitizer: DomSanitizer,
    private resourceService: ResourceService,
    private certRegService: CertRegService,
    public uploadCertificateService: UploadCertificateService,
    public navigationHelperService: NavigationHelperService,
    private activatedRoute: ActivatedRoute,
    private toasterService: ToasterService,
    private router: Router,
    private telemetryService: TelemetryService,
    public layoutService: LayoutService,
    private formService: FormService) {
      this.instance &#x3D; (&lt;HTMLInputElement&gt;document.getElementById(&#x27;instance&#x27;))
      ? (&lt;HTMLInputElement&gt;document.getElementById(&#x27;instance&#x27;)).value : &#x27;sunbird&#x27;;
    }
  /**
   * @description - It will handle back button click.
   */
  @HostListener(&#x27;window:popstate&#x27;, [&#x27;$event&#x27;])
  onPopState(event) {
    if (this.isTemplateChanged) {
      this.isTemplateChanged &#x3D; false;
    }
  }

  /**
   * @since - release-3.2.10
   * @description - It will prepare all the necessary data along with the apis.
   */
  ngOnInit() {
    this.initializeLabels();
    this.layoutConfiguration &#x3D; this.layoutService.initlayoutConfig();
    this.redoLayout();
    this.currentState &#x3D; this.screenStates.default;
    this.uploadCertificateService.certificate.subscribe(res &#x3D;&gt; {
      if (res &amp;&amp; !_.isEmpty(res)) {
        this.showAlertModal &#x3D; true;
        this.currentState &#x3D; &#x27;certRules&#x27;;
        this.showPreviewModal &#x3D; false;
        this.newTemplateIdentifier &#x3D; _.get(res , &#x27;identifier&#x27;);
      }
    });
    this.navigationHelperService.setNavigationUrl();
    this.initializeFormFields();
    this.activatedRoute.queryParams.subscribe((params) &#x3D;&gt; {
      this.queryParams &#x3D; params;
      this.configurationMode &#x3D; _.get(this.queryParams, &#x27;type&#x27;);
    });
    combineLatest(
      this.getCourseDetails(_.get(this.queryParams, &#x27;courseId&#x27;)),
      this.getBatchDetails(_.get(this.queryParams, &#x27;batchId&#x27;)),
      this.getTemplateList(),
      this.getCertificateFormData()
    ).subscribe((data) &#x3D;&gt; {
      this.showLoader &#x3D; false;
      this.checkMultipleAssessment();
    }, (error) &#x3D;&gt; {
      this.showLoader &#x3D; false;
      this.toasterService.error(this.resourceService.messages.emsg.m0005);
    });
  }
  checkMultipleAssessment() {
    try {
      const contentTypes &#x3D; JSON.parse(_.get(this.courseDetails, &#x27;contentTypesCount&#x27;));
    const selfAssessCount &#x3D; _.get(contentTypes, &#x27;SelfAssess&#x27;);
    if (selfAssessCount &amp;&amp; selfAssessCount &gt; 1) {
      this.isSingleAssessment &#x3D; false;
    } else if (selfAssessCount &amp;&amp; selfAssessCount &#x3D;&#x3D; 1) {
      this.isSingleAssessment &#x3D; true;
    } else {
      this.isSingleAssessment &#x3D; false;
    }
    } catch (error) {
      console.log(error)
    }
    
  }
  certificateCreation() {
    this.currentState &#x3D; this.screenStates.certRules;
  }

  /**
   * @description - It will trigger impression telemetry event once the view is ready.
   */
  ngAfterViewInit() {
    this.setTelemetryImpressionData();
  }

  /**
   * @description - It will prepare the config data for the hover activity of the cert-list cards.
   */
  initializeLabels() {
    this.config &#x3D; {
      select: {
        label: _.get(this.resourceService, &#x27;frmelmnts.lbl.Select&#x27;),
        name: &#x27;Select&#x27;,
        show: true
      },
      preview: {
        label: _.get(this.resourceService, &#x27;frmelmnts.cert.lbl.preview&#x27;),
        name: &#x27;Preview&#x27;,
        show: true
      },
      remove: {
        label: _.get(this.resourceService, &#x27;frmelmnts.cert.lbl.unselect&#x27;),
        name: &#x27;Remove&#x27;,
        show: false
      }
    };
  }

  /**
   * @description - It will fetch the drop-down values by calling the preference api with proper request payload.
   */
  getCertConfigFields() {
    const request &#x3D; {
      request: {
        orgId: _.get(this.userService, &#x27;userProfile.rootOrgId&#x27;),
        key: &#x27;certRules&#x27;
      }
    };
    this.certificateService.fetchCertificatePreferences(request).subscribe(certRulesData &#x3D;&gt; {
      const dropDownValues &#x3D; this.certConfigModalInstance.getDropDownValues(_.get(certRulesData, &#x27;result.response.data.fields&#x27;));
      this.certTypes &#x3D; _.get(dropDownValues, &#x27;certTypes&#x27;);
      this.issueTo &#x3D; _.get(dropDownValues, &#x27;issueTo&#x27;);
      this.scoreRange &#x3D; _.get(dropDownValues, &#x27;scoreRange&#x27;);
    }, error &#x3D;&gt; {
      this.toasterService.error(this.resourceService.messages.emsg.m0005);
    });
  }

  /**
   * @description - It will fetch list of certificate templates from preference api.
   */
  getTemplateList() {
    const request &#x3D; {
      &#x27;request&#x27;: {
          &#x27;filters&#x27;: {
              &#x27;certType&#x27;: &#x27;cert template&#x27;,
              &#x27;channel&#x27;: this.userService.channel,
              &#x27;mediaType&#x27;: &#x27;image&#x27;
          },
          &#x27;sort_by&#x27;: {
            &#x27;lastUpdatedOn&#x27;: &#x27;desc&#x27;
          },
          &#x27;fields&#x27;: [&#x27;indentifier&#x27;, &#x27;name&#x27;, &#x27;code&#x27;, &#x27;certType&#x27;, &#x27;data&#x27;, &#x27;issuer&#x27;, &#x27;signatoryList&#x27;, &#x27;artifactUrl&#x27;, &#x27;primaryCategory&#x27;, &#x27;channel&#x27;],
          &#x27;limit&#x27;: 100
      }
  };
  return this.uploadCertificateService.getCertificates(request).pipe(
      tap((certTemplateData) &#x3D;&gt; {
        const templatList &#x3D; _.get(certTemplateData, &#x27;result.content&#x27;);
        this.certTemplateList &#x3D; templatList;
        // To select the newly created certificate
        let tempIdToSelect;
        if (this.newTemplateIdentifier) {
          tempIdToSelect &#x3D; this.newTemplateIdentifier;
        } else {
          tempIdToSelect &#x3D; this.templateIdentifier;
        }
        const templateData &#x3D; templatList.find(templat &#x3D;&gt; tempIdToSelect &amp;&amp; (templat.identifier &#x3D;&#x3D;&#x3D; tempIdToSelect));
        if (templateData) {
          _.remove(this.certTemplateList, (cert) &#x3D;&gt; _.get(cert, &#x27;identifier&#x27;) &#x3D;&#x3D;&#x3D; _.get(templateData , &#x27;identifier&#x27;));
          this.certTemplateList.unshift(templateData);
          this.selectedTemplate &#x3D; templateData;
        }
      }), catchError(error &#x3D;&gt; {
          return of({});
        })
    );
  }

  refreshData() {
    this.getTemplateList().subscribe(response &#x3D;&gt; {
    }, (error) &#x3D;&gt; {
      this.toasterService.error(this.resourceService.messages.emsg.m0005);
    });
  }
  /**
   * @param  {string} batchId
   * @description - It will fetch the batch details.
   */
  getBatchDetails(batchId) {
    return this.certificateService.getBatchDetails(batchId).pipe(
      tap(batchDetails &#x3D;&gt; {
        this.batchDetails &#x3D; _.get(batchDetails, &#x27;result.response&#x27;);
        const cert_templates &#x3D; _.get(this.batchDetails, &#x27;cert_templates&#x27;);
        if (_.isEmpty(cert_templates)) {
          this.getCertConfigFields();
        } else {
          // Certifciate has attached to a batch
          if (_.isArray(cert_templates)) {
            this.batchDetails.cert_templates &#x3D; cert_templates[0];
          }
          this.processCertificateDetails(cert_templates);
        }
      })
    );
  }


  initializeFormFields() {
    this.userPreference &#x3D; new FormGroup({
      scoreRange: new FormControl(&#x27;&#x27;),
      issueTo: new FormControl(&#x27;&#x27;, [Validators.required]),
      allowPermission: new FormControl(&#x27;&#x27;, [Validators.required])
    });
    this.userPreference.valueChanges.subscribe(val &#x3D;&gt; {
      this.validateForm();
    });
  }


  validateForm() {
    if (this.userPreference.status &#x3D;&#x3D;&#x3D; &#x27;VALID&#x27;
      &amp;&amp; _.get(this.userPreference, &#x27;value.allowPermission&#x27;) &amp;&amp; !_.isEmpty(this.selectedTemplate)) {
      this.disableAddCertificate &#x3D; false;
    } else {
      this.disableAddCertificate &#x3D; true;
    }
  }

  /**
   * @param  {string} courseId
   * @description - It will fetch the course details.
   */
  getCourseDetails(courseId: string) {
    return this.playerService.getCollectionHierarchy(courseId).pipe(
      tap(courseData &#x3D;&gt; {
        this.courseDetails &#x3D; _.get(courseData, &#x27;result.content&#x27;);
      }, catchError(error &#x3D;&gt; {
        return of({});
      }))
    );
  }

  /**
   * @description - It will check for the template change or update the certificate.
   */
  updateCertificate() {
    if (this.templateIdentifier !&#x3D;&#x3D; _.get(this.selectedTemplate, &#x27;name&#x27;)) {
      this.isTemplateChanged &#x3D; true;
    } else {
      this.attachCertificateToBatch();
    }
  }

  attachCertificateToBatch() {
    this.sendInteractData({ id: this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;add&#x27; ? &#x27;attach-certificate&#x27; : &#x27;confirm-template-change&#x27; });
    if (this.addScoreRule &#x3D;&#x3D;&#x3D; false) {
      this.userPreference.value[&#x27;scoreRange&#x27;] &#x3D; null;
    }
    const request &#x3D; {
      &#x27;request&#x27;: {
        &#x27;batch&#x27;: {
          &#x27;courseId&#x27;: _.get(this.queryParams, &#x27;courseId&#x27;),
          &#x27;batchId&#x27;: _.get(this.queryParams, &#x27;batchId&#x27;),
          &#x27;template&#x27;: {
            &#x27;identifier&#x27;: _.get(this.selectedTemplate, &#x27;identifier&#x27;),
            &#x27;criteria&#x27;: this.getCriteria(this.userPreference.value),
            &#x27;name&#x27;: _.get(this.selectedTemplate, &#x27;name&#x27;),
            &#x27;issuer&#x27;: JSON.parse(_.get(this.selectedTemplate, &#x27;issuer&#x27;)),
            &#x27;data&#x27;: JSON.stringify(_.get(this.selectedTemplate, &#x27;data&#x27;)),
            &#x27;previewUrl&#x27;: _.get(this.selectedTemplate, &#x27;artifactUrl&#x27;),
            &#x27;signatoryList&#x27;: JSON.parse(_.get(this.selectedTemplate, &#x27;signatoryList&#x27;))
          }
        }
      }
    };

    if (this.isTemplateChanged) {
      request[&#x27;request&#x27;][&#x27;oldTemplateId&#x27;] &#x3D; this.templateIdentifier;
    }
    this.certRegService.addCertificateTemplate(request).subscribe(data &#x3D;&gt; {
      this.isTemplateChanged &#x3D; false;
      if (this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;add&#x27;) {
        this.toasterService.success(_.get(this.resourceService, &#x27;frmelmnts.cert.lbl.certAddSuccess&#x27;));
      } else {
        this.toasterService.success(_.get(this.resourceService, &#x27;frmelmnts.cert.lbl.certUpdateSuccess&#x27;));
      }
      this.certificateService.getBatchDetails(_.get(this.queryParams, &#x27;batchId&#x27;)).subscribe(batchDetails &#x3D;&gt; {
        this.batchDetails &#x3D; _.get(batchDetails, &#x27;result.response&#x27;);
        this.processCertificateDetails(_.get(this.batchDetails, &#x27;cert_templates&#x27;));
        this.goBack();
      }, error &#x3D;&gt; {
        this.toasterService.error(this.resourceService.messages.emsg.m0005);
      });
    }, error &#x3D;&gt; {
      if (this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;add&#x27;) {
        this.toasterService.error(_.get(this.resourceService, &#x27;frmelmnts.cert.lbl.certAddError&#x27;));
      } else {
        this.toasterService.error(_.get(this.resourceService, &#x27;frmelmnts.cert.lbl.certEditError&#x27;));
      }
    });
  }

  processCertificateDetails(certTemplateDetails) {
    const templateData &#x3D; _.pick(_.get(certTemplateDetails, Object.keys(certTemplateDetails)), [&#x27;criteria&#x27;, &#x27;previewUrl&#x27;, &#x27;artifactUrl&#x27;, &#x27;identifier&#x27;, &#x27;data&#x27;, &#x27;issuer&#x27;, &#x27;signatoryList&#x27;, &#x27;name&#x27;, &#x27;url&#x27;]);
    this.templateIdentifier &#x3D; _.get(templateData, &#x27;identifier&#x27;);
    this.selectedTemplate &#x3D; {
      &#x27;name&#x27;: _.get(templateData, &#x27;name&#x27;),
      &#x27;identifier&#x27;: _.get(templateData, &#x27;identifier&#x27;),
      &#x27;previewUrl&#x27;: _.get(templateData, &#x27;previewUrl&#x27;),
      &#x27;issuer&#x27;: JSON.stringify(_.get(templateData, &#x27;issuer&#x27;)),
      &#x27;data&#x27;: JSON.stringify(_.get(templateData, &#x27;data&#x27;)),
      &#x27;signatoryList&#x27;: JSON.stringify(_.get(templateData, &#x27;signatoryList&#x27;)),
      &#x27;artifactUrl&#x27;: _.get(templateData, &#x27;artifactUrl&#x27;)
     };
     if (!_.get(templateData, &#x27;previewUrl&#x27;) &amp;&amp; _.get(templateData, &#x27;url&#x27;)) {
      this.selectedTemplate[&#x27;previewUrl&#x27;] &#x3D; _.get(templateData, &#x27;url&#x27;);
      templateData[&#x27;previewUrl&#x27;] &#x3D; _.get(templateData, &#x27;url&#x27;);
     }
    // if (!_.isEmpty(this.newTemplateIdentifier)) {
    //   this.templateIdentifier &#x3D; this.newTemplateIdentifier;
    //   this.selectedTemplate &#x3D; null;
    // }
    this.previewUrl &#x3D; _.get(templateData, &#x27;previewUrl&#x27;);
    this.setCertEditable();
    this.processCriteria(_.get(templateData, &#x27;criteria&#x27;));
  }

  setCertEditable() {
    this.certEditable &#x3D; this.previewUrl ? true : false;
  }

  editCertificate() {
    this.configurationMode &#x3D; &#x27;edit&#x27;;
    this.currentState &#x3D; this.screenStates.certRules;
    this.sendInteractData({ id: &#x27;edit-certificate&#x27; });
  }

  getCriteria(rawDropdownValues) {
    const processedData &#x3D; this.certConfigModalInstance.processDropDownValues(rawDropdownValues, _.get(this.userService, &#x27;userProfile.rootOrgId&#x27;));
    return processedData;
  }

  processCriteria(criteria) {
    const data &#x3D; this.certConfigModalInstance.processCriteria(criteria);
    this.issueTo &#x3D; _.get(data, &#x27;issueTo&#x27;);
    const scoreRange &#x3D; _.get(data, &#x27;scoreRange&#x27;);
    if (scoreRange) {
      this.addRule();
    }
    const scoreRangeFormEle &#x3D; this.userPreference.controls[&#x27;scoreRange&#x27;];
    const issueToFormEle &#x3D; this.userPreference.controls[&#x27;issueTo&#x27;];
    this.issueTo &amp;&amp; this.issueTo.length &gt; 0 ? issueToFormEle.setValue(this.issueTo[0].name) : issueToFormEle.setValue(&#x27;&#x27;);
    scoreRange ? scoreRangeFormEle.setValue(scoreRange) : scoreRangeFormEle.setValue(&#x27;&#x27;);
  }

  handleCertificateEvent(event, template: {}) {
    const show &#x3D; _.get(this.selectedTemplate, &#x27;name&#x27;) &#x3D;&#x3D;&#x3D; _.get(template, &#x27;name&#x27;);
    switch (_.lowerCase(_.get(event, &#x27;name&#x27;))) {
      case &#x27;select&#x27;:
        this.selectedTemplate &#x3D; template;
        this.config.remove.show &#x3D; show;
        this.config.select.show &#x3D; !show;
        this.validateForm();
        this.sendInteractData({ id: &#x27;select-template&#x27; });
        break;
      case &#x27;remove&#x27;:
        this.selectedTemplate &#x3D; {};
        this.config.select.show &#x3D; show;
        this.config.remove.show &#x3D; !show;
        this.validateForm();
        this.sendInteractData({ id: &#x27;unselect-template&#x27; });
        break;
      case &#x27;preview&#x27;:
        this.previewTemplate &#x3D; template;
        this.showPreviewModal &#x3D; true;
        this.sendInteractData({ id: &#x27;preview-template&#x27; });
        break;
    }
  }

  getConfig(config: { show: boolean, label: string, name: string }, template) {
    const show &#x3D; _.get(this.selectedTemplate, &#x27;name&#x27;) &#x3D;&#x3D;&#x3D; _.get(template, &#x27;name&#x27;);
    if (_.lowerCase(_.get(config, &#x27;label&#x27;)) &#x3D;&#x3D;&#x3D; &#x27;select&#x27;) {
      return ({ show: !show, label: config.label, name: config.name });
    } else {
      return ({ show: show, label: config.label, name: config.name });
    }
  }

  closeModal(event) {
    _.remove(this.certTemplateList, (template) &#x3D;&gt; _.get(template, &#x27;identifier&#x27;) &#x3D;&#x3D;&#x3D; _.get(event, &#x27;template.identifier&#x27;));
    this.certTemplateList.unshift(_.get(event, &#x27;template&#x27;));
    this.showPreviewModal &#x3D; false;
    this.selectedTemplate &#x3D; _.get(event, &#x27;name&#x27;) ? _.get(event, &#x27;template&#x27;) : this.selectedTemplate;
    this.validateForm();
    if (_.get(event, &#x27;name&#x27;)) {
      this.sendInteractData({ id: &#x27;select-template&#x27; });
    } else {
      this.sendInteractData({ id: &#x27;close-preview&#x27; });
    }
  }

  closeTemplateDetectModal() {
    this.isTemplateChanged &#x3D; false;
    this.sendInteractData({ id: &#x27;cancel-template-change&#x27; });
  }

  navigateToCertRules() {
    this.currentState &#x3D; this.screenStates.certRules;
    this.sendInteractData({ id: &#x27;add-certificate&#x27; });
  }

  goBack() {
    if (this.currentState &#x3D;&#x3D;&#x3D; this.screenStates.certRules) {
      // Goback to cert list screen
      this.currentState &#x3D; this.screenStates.default;
    } else {
      this.router.navigate([&#x60;/learn/course/${_.get(this.queryParams, &#x27;courseId&#x27;)}&#x60;]);
    }
  }

  cancelSelection() {
    this.currentState &#x3D; this.screenStates.default;
    this.userPreference.controls[&#x27;allowPermission&#x27;].reset();
    this.sendInteractData({ id: this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;add&#x27; ? &#x27;cancel-add-certificate&#x27; : &#x27;cancel-update-certificate&#x27; });
    if (this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;add&#x27;) {
      this.userPreference.reset();
      this.selectedTemplate &#x3D; {};
    } else {
      const cert_templates &#x3D; _.get(this.batchDetails, &#x27;cert_templates&#x27;);
      this.processCertificateDetails(cert_templates);
    }
  }

  setTelemetryImpressionData() {
    this.telemetryImpression &#x3D; {
      context: {
        env: this.activatedRoute.snapshot.data.telemetry.env,
        cdata: [{
          type: &#x27;Batch&#x27;,
          id: _.get(this.queryParams, &#x27;batchId&#x27;)
        },
        {
          type: &#x27;Course&#x27;,
          id: _.get(this.queryParams, &#x27;courseId&#x27;)
        }]
      },
      edata: {
        type: this.activatedRoute.snapshot.data.telemetry.type,
        subtype: this.activatedRoute.snapshot.data.telemetry.subtype,
        pageid: this.activatedRoute.snapshot.data.telemetry.pageid,
        uri: this.router.url,
        duration: this.navigationHelperService.getPageLoadTime()
      }
    };
    this.telemetryService.impression(this.telemetryImpression);
  }

  sendInteractData(interactData) {
    const data &#x3D; {
      context: {
        env: this.activatedRoute.snapshot.data.telemetry.env,
        cdata: [{
          type: &#x27;Batch&#x27;,
          id: _.get(this.queryParams, &#x27;batchId&#x27;)
        },
        {
          type: &#x27;Course&#x27;,
          id: _.get(this.queryParams, &#x27;courseId&#x27;)
        }]
      },
      edata: {
        id: _.get(interactData, &#x27;id&#x27;),
        type: &#x27;CLICK&#x27;,
        pageid: this.activatedRoute.snapshot.data.telemetry.pageid
      }
    };

    if (this.configurationMode &#x3D;&#x3D;&#x3D; &#x27;edit&#x27;) {
      data[&#x27;object&#x27;] &#x3D; {
        id: _.get(this.selectedTemplate, &#x27;name&#x27;),
        type: &#x27;Certificate&#x27;,
        ver: &#x27;1.0&#x27;,
        rollup: { l1: _.get(this.queryParams, &#x27;courseId&#x27;) }
      };
    }

    this.telemetryService.interact(data);
  }

  navigateToCreateTemplate() {
    if(_.get(this.certificateFormConfig, &#x27;enableSVGEditor&#x27;)) {
      this.router.navigate([&#x60;/certs/configure/create-certificate-template&#x60;], {
        queryParams: {
          type: this.configurationMode,
          courseId: _.get(this.queryParams, &#x27;courseId&#x27;),
          batchId: _.get(this.queryParams, &#x27;batchId&#x27;)
        }
      });
    } else {
      this.router.navigate([&#x60;/certs/configure/create-template&#x60;], {
        queryParams: {
          type: this.configurationMode,
          courseId: _.get(this.queryParams, &#x27;courseId&#x27;),
          batchId: _.get(this.queryParams, &#x27;batchId&#x27;)
        }
      });
    }
  }
  removeSelectedCertificate() {
    this.selectedTemplate &#x3D; null;
  }
  ngOnDestroy() {
    this.unsubscribe$.next();
    this.unsubscribe$.complete();
    this.uploadCertificateService.certificate.next(null);
  }
  public addRule() {
    this.addScoreRule &#x3D; true;
    let range &#x3D; 100;
    const step &#x3D; 10;
    const arr &#x3D; [];
    while (range &gt; 0) {
      arr.push(range);
      range &#x3D; range - step;
    }
    this.arrayValue[&#x27;range&#x27;] &#x3D; arr;
  }
  removeRule() {
    setTimeout(() &#x3D;&gt; {
      this.userPreference.value[&#x27;scoreRange&#x27;] &#x3D; null;
    }, 500);
    this.addScoreRule &#x3D; false;
  }
  redoLayout() {
    if (this.layoutConfiguration !&#x3D; null) {
      this.FIRST_PANEL_LAYOUT &#x3D; this.layoutService.redoLayoutCSS(0, this.layoutConfiguration, COLUMN_TYPE.threeToNine);
      this.SECOND_PANEL_LAYOUT &#x3D; this.layoutService.redoLayoutCSS(1, this.layoutConfiguration, COLUMN_TYPE.threeToNine);
    } else {
      this.FIRST_PANEL_LAYOUT &#x3D; this.layoutService.redoLayoutCSS(0, null, COLUMN_TYPE.fullLayout);
      this.SECOND_PANEL_LAYOUT &#x3D; this.layoutService.redoLayoutCSS(1, null, COLUMN_TYPE.fullLayout);
    }
  }
  handleParameterChange(event) {
    if (_.get(event, &#x27;value&#x27;) &#x3D;&#x3D;&#x3D; &#x27;My state teacher&#x27;) {
      this.isStateCertificate &#x3D; true;
    } else {
      this.isStateCertificate &#x3D; false;
    }
  }

  getCertificateFormData() {
    const formServiceInputParams &#x3D; {
      formType: &#x27;certificate&#x27;,
      contentType: &#x27;course&#x27;,
      formAction: &#x27;certificateCreate&#x27;,
      component: &#x27;portal&#x27;
    };
    return this.formService.getFormConfig(formServiceInputParams, null, &#x27;data&#x27;).pipe(
      map((data) &#x3D;&gt; {
        this.certificateFormConfig &#x3D; data;
        return data;
      }),tap(mapping &#x3D;&gt; {
      }),
        catchError((err) &#x3D;&gt; {
          return of([])
        })
      );
  }
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'IConfigLabels.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
